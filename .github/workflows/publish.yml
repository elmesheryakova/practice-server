name: Deploy
on:
  push:
    branches: [ master ]
jobs:
  convert-form-ts-to-js:
    runs-on: ubuntu-latest
    steps:
      - name: Get repo code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: convert form ts to js
        run: npm run tsc
  deploy:
    runs-on: ubuntu-latest
    needs: convert-form-ts-to-js
    steps:
      - name: Deploy and Build
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER_NAME }}
          password: ${{ secrets.PASSWORD }}
          debug: true
          command_timeout: 20m
          script: |
            cd ${{ secrets.DIR }}
            git fetch origin master
            git reset --hard origin/master
            rm -rf docker/prod/nginx/conf.d/practice-server
            cp docker-compose.yml
            docker-compose up -d --build

