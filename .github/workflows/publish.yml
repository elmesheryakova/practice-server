name: Deploy
on:
  push:
    branches: [ master ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy and Build
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER_NAME }}
          password: ${{ secrets.PASSWORD }}
          debug: true
          command_timeout: 20m
          script: |
            cd ${{ secrets.DIR }}
            git pull
  convert-form-ts-to-js:
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - name: Get repo code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: convert form ts to js
        run: npm run tsc
      - run: npm install pm2@latest -g
      - run: pm2 start dist/index.js
